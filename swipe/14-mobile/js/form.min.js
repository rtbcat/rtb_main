VarienForm=Class.create(),VarienForm.prototype={initialize:function(formId,firstFieldFocus){if(this.form=$(formId),this.form&&(this.cache=$A(),this.currLoader=!1,this.currDataIndex=!1,this.validator=new Validation(this.form),this.elementFocus=this.elementOnFocus.bindAsEventListener(this),this.elementBlur=this.elementOnBlur.bindAsEventListener(this),this.childLoader=this.onChangeChildLoad.bindAsEventListener(this),this.highlightClass="highlight",this.extraChildParams="",this.firstFieldFocus=firstFieldFocus||!1,this.bindElements(),this.firstFieldFocus))try{Form.Element.focus(Form.findFirstElement(this.form))}catch(e){}},submit:function(url){return this.validator&&this.validator.validate()&&this.form.submit(),!1},bindElements:function(){var elements=Form.getElements(this.form);for(var row in elements)elements[row].id&&(Event.observe(elements[row],"focus",this.elementFocus),Event.observe(elements[row],"blur",this.elementBlur))},elementOnFocus:function(event){var element=Event.findElement(event,"fieldset");element&&Element.addClassName(element,this.highlightClass)},elementOnBlur:function(event){var element=Event.findElement(event,"fieldset");element&&Element.removeClassName(element,this.highlightClass)},setElementsRelation:function(parent,child,dataUrl,first){(parent=$(parent))&&(this.cache[parent.id]||(this.cache[parent.id]=$A(),this.cache[parent.id].child=child,this.cache[parent.id].dataUrl=dataUrl,this.cache[parent.id].data=$A(),this.cache[parent.id].first=first||!1),Event.observe(parent,"change",this.childLoader))},onChangeChildLoad:function(event){element=Event.element(event),this.elementChildLoad(element)},elementChildLoad:function(element,callback){this.callback=callback||!1,element.value&&(this.currLoader=element.id,this.currDataIndex=element.value,this.cache[element.id].data[element.value]?this.setDataToChild(this.cache[element.id].data[element.value]):new Ajax.Request(this.cache[this.currLoader].dataUrl,{method:"post",parameters:{parent:element.value},onComplete:this.reloadChildren.bind(this)}))},reloadChildren:function(transport){var data=transport.responseJSON||transport.responseText.evalJSON(!0)||{};this.cache[this.currLoader].data[this.currDataIndex]=data,this.setDataToChild(data)},setDataToChild:function(data){if(data.length){var child=$(this.cache[this.currLoader].child);if(child){var html='<select name="'+child.name+'" id="'+child.id+'" class="'+child.className+'" title="'+child.title+'" '+this.extraChildParams+">";this.cache[this.currLoader].first&&(html+='<option value="">'+this.cache[this.currLoader].first+"</option>");for(var i in data)data[i].value&&(html+='<option value="'+data[i].value+'"',!child.value||child.value!=data[i].value&&child.value!=data[i].label||(html+=" selected"),html+=">"+data[i].label+"</option>");html+="</select>",Element.insert(child,{before:html}),Element.remove(child)}}else{var child=$(this.cache[this.currLoader].child);if(child){var html='<input type="text" name="'+child.name+'" id="'+child.id+'" class="'+child.className+'" title="'+child.title+'" '+this.extraChildParams+">";Element.insert(child,{before:html}),Element.remove(child)}}this.bindElements(),this.callback&&this.callback()}},RegionUpdater=Class.create(),RegionUpdater.prototype={initialize:function(countryEl,regionTextEl,regionSelectEl,regions,disableAction,zipEl){this.countryEl=$(countryEl),this.regionTextEl=$(regionTextEl),this.regionSelectEl=$(regionSelectEl),this.zipEl=$(zipEl),this.config=regions.config,delete regions.config,this.regions=regions,this.disableAction="undefined"==typeof disableAction?"hide":disableAction,this.zipOptions="undefined"!=typeof zipOptions&&zipOptions,this.regionSelectEl.options.length<=1&&this.update(),Event.observe(this.countryEl,"change",this.update.bind(this))},_checkRegionRequired:function(){var label,wildCard,elements=[this.regionTextEl,this.regionSelectEl],that=this;if("undefined"!=typeof this.config){var regionRequired=this.config.regions_required.indexOf(this.countryEl.value)>=0;elements.each(function(currentElement){Validation.reset(currentElement),label=$$('label[for="'+currentElement.id+'"]')[0],label&&(wildCard=label.down("em")||label.down("span.required"),that.config.show_all_regions||(regionRequired?label.up().show():label.up().hide())),label&&wildCard&&(regionRequired?regionRequired&&(wildCard.show(),label.hasClassName("required")||label.addClassName("required")):(wildCard.hide(),label.hasClassName("required")&&label.removeClassName("required"))),regionRequired?(currentElement.hasClassName("required-entry")||currentElement.addClassName("required-entry"),"select"!=currentElement.tagName.toLowerCase()||currentElement.hasClassName("validate-select")||currentElement.addClassName("validate-select")):(currentElement.hasClassName("required-entry")&&currentElement.removeClassName("required-entry"),"select"==currentElement.tagName.toLowerCase()&&currentElement.hasClassName("validate-select")&&currentElement.removeClassName("validate-select"))})}},update:function(){if(this.regions[this.countryEl.value]){var option,region,def;def=this.regionSelectEl.getAttribute("defaultValue"),this.regionTextEl&&(def||(def=this.regionTextEl.value.toLowerCase()),this.regionTextEl.value=""),this.regionSelectEl.options.length=1;for(regionId in this.regions[this.countryEl.value])region=this.regions[this.countryEl.value][regionId],option=document.createElement("OPTION"),option.value=regionId,option.text=region.name.stripTags(),option.title=region.name,this.regionSelectEl.options.add?this.regionSelectEl.options.add(option):this.regionSelectEl.appendChild(option),(regionId==def||region.name&&region.name.toLowerCase()==def||region.name&&region.code.toLowerCase()==def)&&(this.regionSelectEl.value=regionId);this.sortSelect(),"hide"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.style.display="none"),this.regionSelectEl.style.display=""):"disable"==this.disableAction&&(this.regionTextEl&&(this.regionTextEl.disabled=!0),this.regionSelectEl.disabled=!1),this.setMarkDisplay(this.regionSelectEl,!0)}else this.regionSelectEl.options.length=1,this.sortSelect(),"hide"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.style.display=""),this.regionSelectEl.style.display="none",Validation.reset(this.regionSelectEl)):"disable"==this.disableAction?(this.regionTextEl&&(this.regionTextEl.disabled=!1),this.regionSelectEl.disabled=!0):"nullify"==this.disableAction&&(this.regionSelectEl.options.length=1,this.regionSelectEl.value="",this.regionSelectEl.selectedIndex=0,this.lastCountryId=""),this.setMarkDisplay(this.regionSelectEl,!1);this._checkRegionRequired();var zipUpdater=new ZipUpdater(this.countryEl.value,this.zipEl);zipUpdater.update()},setMarkDisplay:function(elem,display){elem=$(elem);var labelElement=elem.up(0).down("label > span.required")||elem.up(1).down("label > span.required")||elem.up(0).down("label.required > em")||elem.up(1).down("label.required > em");labelElement&&(inputElement=labelElement.up().next("input"),display?(labelElement.show(),inputElement&&inputElement.addClassName("required-entry")):(labelElement.hide(),inputElement&&inputElement.removeClassName("required-entry")))},sortSelect:function(){for(var elem=this.regionSelectEl,tmpArray=new Array,currentVal=$(elem).value,i=0;i<$(elem).options.length;i++)0!=i&&(tmpArray[i-1]=new Array,tmpArray[i-1][0]=$(elem).options[i].text,tmpArray[i-1][1]=$(elem).options[i].value);tmpArray.sort();for(var i=1;i<=tmpArray.length;i++){var op=new Option(tmpArray[i-1][0],tmpArray[i-1][1]);$(elem).options[i]=op}$(elem).value=currentVal}},ZipUpdater=Class.create(),ZipUpdater.prototype={initialize:function(country,zipElement){this.country=country,this.zipElement=$(zipElement)},update:function(){return"undefined"!=typeof optionalZipCountries&&void(void 0!=this.zipElement?(Validation.reset(this.zipElement),this._setPostcodeOptional()):Event.observe(window,"load",this._setPostcodeOptional.bind(this)))},_setPostcodeOptional:function(){if(this.zipElement=$(this.zipElement),void 0==this.zipElement)return!1;var label=$$('label[for="'+this.zipElement.id+'"]')[0];if(void 0!=label)var wildCard=label.down("em")||label.down("span.required");if(optionalZipCountries.indexOf(this.country)!=-1){for(;this.zipElement.hasClassName("required-entry");)this.zipElement.removeClassName("required-entry");void 0!=wildCard&&wildCard.hide()}else this.zipElement.addClassName("required-entry"),void 0!=wildCard&&wildCard.show()}};