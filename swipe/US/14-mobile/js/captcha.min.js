var Captcha=Class.create();Captcha.prototype={initialize:function(url,formId){this.url=url,this.formId=formId},refresh:function(elem){formId=this.formId,elem&&Element.addClassName(elem,"refreshing"),new Ajax.Request(this.url,{onSuccess:function(response){if(response.responseText.isJSON()){var json=response.responseText.evalJSON();!json.error&&json.imgSrc?($(formId).writeAttribute("src",json.imgSrc),elem&&Element.removeClassName(elem,"refreshing")):elem&&Element.removeClassName(elem,"refreshing")}},method:"post",parameters:{formId:this.formId}})}},document.observe("billing-request:completed",function(event){"undefined"!=typeof window.checkout&&("guest"==window.checkout.method&&$("guest_checkout")&&$("guest_checkout").captcha.refresh(),"register"==window.checkout.method&&$("register_during_checkout")&&$("register_during_checkout").captcha.refresh())}),document.observe("login:setMethod",function(event){var switchCaptchaElement=function(shown,hidden){var inputPrefix="captcha-input-box-",imagePrefix="captcha-image-box-";$(inputPrefix+hidden)&&($(inputPrefix+hidden).hide(),$(imagePrefix+hidden).hide()),$(inputPrefix+shown)&&($(inputPrefix+shown).show(),$(imagePrefix+shown).show())};switch(event.memo.method){case"guest":switchCaptchaElement("guest_checkout","register_during_checkout");break;case"register":switchCaptchaElement("register_during_checkout","guest_checkout")}});