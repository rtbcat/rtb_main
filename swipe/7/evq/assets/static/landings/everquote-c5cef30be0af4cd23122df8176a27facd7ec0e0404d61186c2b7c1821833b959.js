"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,o){for(var r=0;r<o.length;r++){var i=o[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(o,r,i){return r&&e(o.prototype,r),i&&e(o,i),o}}(),EverQuoteValidator=function(){function e(){_classCallCheck(this,e),this.onZipCodeChange=this.onZipCodeChange.bind(this),this.onReasonForQuoteChange=this.onReasonForQuoteChange.bind(this),this.onEmailChange=this.onEmailChange.bind(this),this.checkZipCodeError=this.checkZipCodeError.bind(this),this.checkReasonForQuoteError=this.checkReasonForQuoteError.bind(this),this.checkRadioButtonError=this.checkRadioButtonError.bind(this),this.processZipCode=this.processZipCode.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this)}return _createClass(e,[{key:"preventBackspace",value:function(e){return 8!==e.which}},{key:"fieldIsValid",value:function(e){var o=!0;switch(e.id){case"landing-zip-code":o=/\d{5}/.test(e.value);break;case"reason-for-quote":o=!!e.value;break;case"landing_email":o=e.value?/^.+@.+\..{2,}/.test(e.value):!0;break;default:o=!0}return o?($(e).removeClass("error").closest("div").removeClass("field_with_errors"),$("label[for="+e.id+"]").removeClass("field_with_errors")):$(e).addClass("error").closest("div").addClass("field_with_errors"),o}},{key:"onZipCodeChange",value:function(e){var o=e.target.value,r=this.fieldIsValid(e.target);return r&&$(".mast-map").length&&this.processZipCode(o),r}},{key:"checkZipCodeError",value:function(){var e=$("#landing-zip-code");return!e.hasClass("error")&&this.fieldIsValid(e[0])}},{key:"onReasonForQuoteChange",value:function(e){var o=this.fieldIsValid(e.target);return o&&e.target.value?$(".vehicle-count").slideDown(150):$(".vehicle-count").slideUp(150),o}},{key:"onEmailChange",value:function(e){var o=this.fieldIsValid(e.target);return o}},{key:"checkReasonForQuoteError",value:function(){var e=!0,o=$("#reason-for-quote"),r=$("[name*=reason_for_quote]"),i=$("[for=landing__x_reason_for_quote]");return o.length?this.fieldIsValid(o[0])||(e=!1):r.length&&(r.filter(":checked").length?i.removeClass("field_with_errors"):(i.addClass("field_with_errors"),e=!1)),e}},{key:"checkRadioButtonError",value:function(){var e=$("input[type=radio]").not("[name*=vehicle_count]"),o=!1;if(0!==e.length)return e.each(function(){this&&this.checked&&(o=!0,$(this).parent().find(".field_with_errors").each(function(){$(this).removeClass("field_with_errors")}))}),o}},{key:"ajaxValidate",value:function(e){var o=void 0,r=void 0,i=!1,n=$(e.currentTarget),t=n.serialize();return $.ajax({url:"/validators/landing_validator",data:t,async:!1}).done(function(e){if("fail"==e.status)for(r in e.errors)e.errors.hasOwnProperty(r)&&(o=$("#zip-submit-container").find(":input[name*="+r+"]").not("[type=hidden]").addClass("error"),$("#zip-submit-container").find('[for*="'+(o.data("error-label")||o[0].id)+'"]').addClass("field_with_errors"));else i=!0}),i&&n.data("form-popunder")&&this.popUnder(n[0],n.data("popunder-timeout")),i}},{key:"processZipCode",value:function(e){var o=$("#reason-for-quote"),r=$(".reason-for-quote");$.getJSON("/api/agent_listings/find_by_zip_code",{zip_code:e}).done(function(i){$(".zip-code .alert-box.error").slideUp(150),o.removeClass("error"),r.removeClass("field_with_errors").slideDown(150,function(){o.focus()}),window.eqAgentMap.focusMap(e,i)}).fail(function(){$("#landing-zip-code").addClass("error"),!Modernizr.touch&&$("#zip-landing").length&&($(".vehicle-count").slideUp(150),r.removeClass("field_with_errors").slideUp(150))})}},{key:"popUnder",value:function(e,o){var r=$('[name="landing[zip_code]"]').last().val(),i="quick";e.target=i,setTimeout(function(){var e=window.open("",i),o=(e?"/exits?&path=0&zip_code=":"/auto_policies?zip_code=")+r;window.location.href=location.protocol+"//"+location.host+o},o)}},{key:"onFormSubmit",value:function(e){return this.checkZipCodeError(),this.checkReasonForQuoteError(),this.checkRadioButtonError(),this.ajaxValidate(e)}}]),e}();!function(e){e(function(){var o=e("#zip-submit-container"),r=e("#zip-landing"),i=e("#everquote-article"),n=new EverQuoteValidator;o.on("keydown keyup keypress","#zip-landing select, #zip-landing button",n.preventBackspace).on("keyup","#landing-zip-code",n.onZipCodeChange).on("change","#reason-for-quote, [name*=reason_for_quote]",n.onReasonForQuoteChange).on("change keyup input","#landing_email",n.onEmailChange),r.on("submit",n.onFormSubmit),i.on("change","[name*=license_status]",n.checkRadioButtonError).on("submit",n.onFormSubmit)})}(jQuery);